# HashMap 小结

* Java 中 HashMap是基于Map实现的，它允许 null 值和 null 键。
* 除了 非同步 以及 允许 null，HashMap 和 HashTable 基本一致。
* HashMap 不保证顺序。
* 哈希函数通过 key的哈希值的高16位异或低16位来实现:

    ```java
    h = key.hashCode()) ^ (h >>> 16
    ```

    使用计算得到的哈希值与数组长度 n-1 做与位运算得到数组下标

    ```java
    if ((p = tab[i = (n - 1) & hash]) == null)
    ```

* HashMap 的 put 方法执行过程
  * 获取 key 对应的哈希值，计算数组下标；
  * 如果没有哈希冲突，则直接放入数组；否则以链表的方式放在链表后面；
  * 如果链表长度超过阈值8， 就把链表转成红黑树；链表长度低于6，就把红黑树转回链表；
  * 如果节点的 key 不存在，直接插入；如果已存在，则替换其value；
  * 如果集合中键值对大于12，对数组进行扩容。
* HashMap 扩容机制
  * openjdk 8 中 HashMap 的初始化容量为 16，负载因子为 0.75；指定初始容量时推荐使用2的倍数作数组长度。
  * 创建一个新数组，其容量为旧数据的两倍；
  * 将原数组中的元素迁移至新数组。
  * 扩容是一个特别消耗性能的操作，因此在使用 HashMap 的时候应估算好大小，避免频繁扩容。
